<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MB Beauty Club - Услуги</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html {
        scroll-behavior: smooth;
    }
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #EBE3D5;
        color: #333;
    }

    .playfair {
        font-family: 'Playfair Display', serif;
    }

    .sticky-header-space {
        padding-top: 1rem;
    }

    /* Custom styles for the filter buttons */
    .filter-buttons {
        position: sticky;
        top: 0;
        z-index: 10; /* Lowered z-index */
        background-color: #EBE3D5;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        white-space: nowrap;
        padding: 1rem 0;
        border-bottom: 1px solid #d1d5db;
    }
    .filter-buttons::-webkit-scrollbar {
        display: none;
    }
    .filter-buttons a {
        display: inline-block;
        flex-shrink: 0;
    }
    .filter-buttons .active {
        background-color: #374151;
        color: #fff;
        border-color: #374151;
    }

    .category-section {
        scroll-margin-top: 5rem;
    }
  </style>
</head>
<body class="overflow-x-hidden min-h-screen">

<div th:insert="~{fragments/header :: main-header}"></div>

<!-- START: Reduced padding from pt-32 to pt-24 -->
<div class="container mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-16">
  <!-- END: Change -->

  <div class="flex flex-col sm:flex-row justify-between items-center mb-8">
    <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold playfair mb-4 sm:mb-0">Нашите услуги</h1>
    <a th:if="${session.sessionRole == 'ADMIN'}" th:href="@{/services/edit}"
       class="inline-flex items-center space-x-2 px-6 py-3 bg-gray-800 text-white font-semibold rounded-full hover:bg-gray-700 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
           stroke="currentColor" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.652.662c-.593.148-1.12.18-1.574-.019A1.875 1.875 0 011 18.259V16.65a4.5 4.5 0 011.13-1.897l13.916-13.92z"/>
      </svg>
      <span>Редактирай услуги</span>
    </a>
  </div>

  <div class="filter-buttons flex gap-4">
    <a th:each="category : ${T(com.example.MB_beauty_club_frontend.enums.WorkerCategory).values()}"
       th:href="${'#' + category.toString()}"
       th:data-category-id="${category.toString()}"
       class="px-4 py-2 border-2 border-gray-800 text-gray-800 font-semibold rounded-full hover:bg-gray-800 hover:text-white transition-colors">
      <span th:text="${category.getDescription()}"></span>
    </a>
  </div>

  <section class="py-8 sm:py-16">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">

      <div th:each="category : ${T(com.example.MB_beauty_club_frontend.enums.WorkerCategory).values()}"
           th:id="${category.toString()}"
           class="mb-12 category-section">

        <h2 class="text-3xl font-bold playfair mb-6 text-center">
          <span th:text="${category.getDescription()}"></span>
        </h2>

        <div class="bg-white/60 backdrop-blur-sm rounded-xl shadow-md p-6 sm:p-8">
          <div class="space-y-4">

            <div th:each="service : ${services}" th:if="${service.category.equals(category)}"
                 class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-6 border-b border-gray-300 last:border-b-0">

              <div class="flex-grow mb-4 sm:mb-0 sm:pr-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-2" th:text="${service.name}"></h3>
                <p class="text-gray-700 text-sm" th:text="${service.description}"></p>
              </div>

              <div class="flex-shrink-0 flex flex-row items-center justify-between sm:justify-end sm:gap-5 w-full sm:w-auto">
                <span class="inline-block bg-gray-200 text-gray-900 text-xs font-semibold px-3 py-1 rounded-full"
                      th:text="${service.duration + ' минути'}">
                </span>
                <a th:href="@{'/appointments/select_worker/' + ${service.id}}"
                   class="text-center px-5 py-2 bg-gray-800 text-white font-semibold rounded-full hover:bg-gray-700 transition-colors">
                  Запази час
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<div th:insert="~{fragments/footer :: main-footer}"></div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
      // No changes needed to the JavaScript
      const categories = document.querySelectorAll('.category-section');
      const navLinks = document.querySelectorAll('.filter-buttons a');

      function removeActiveClasses() {
          navLinks.forEach(link => {
              link.classList.remove('active');
          });
      }

      function addActiveClass(id) {
          const link = document.querySelector(`.filter-buttons a[data-category-id="${id}"]`);
          if (link) {
              removeActiveClasses();
              link.classList.add('active');
              // Scroll the active link into view
              link.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
          }
      }

      const observerOptions = {
          root: null,
          rootMargin: '0px 0px -50% 0px', // When the element is in the middle of the viewport
          threshold: 0
      };

      const observer = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
              if (entry.isIntersecting) {
                  const categoryId = entry.target.id;
                  addActiveClass(categoryId);
              }
          });
      }, observerOptions);

      categories.forEach(section => {
          observer.observe(section);
      });

      navLinks.forEach(link => {
          link.addEventListener('click', (event) => {
              event.preventDefault();
              const targetId = link.getAttribute('href').substring(1);
              const targetElement = document.getElementById(targetId);
              if (targetElement) {
                  // This will now respect the scroll-margin-top from the CSS
                  targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
              }
          });
      });
  });
</script>
</body>
</html>
